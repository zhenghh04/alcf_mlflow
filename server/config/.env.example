# Portable server config template for a fresh machine.
# Copy to server/.env and adjust values before running setup scripts.

MLFLOW_HOME=${HOME}/alcf_mlflow/server/runtime
VENV_DIR=${MLFLOW_HOME}/venv
BACKEND_STORE_URI=sqlite:///${MLFLOW_HOME}/data/mlflow.db
ARTIFACT_ROOT=${MLFLOW_HOME}/artifacts

MLFLOW_HOST=127.0.0.1
MLFLOW_PORT=8080
MLFLOW_INTERNAL_UPSTREAM=http://127.0.0.1:8080

MLFLOW_LOG_FILE=${MLFLOW_HOME}/logs/mlflow.log
MLFLOW_PID_FILE=${MLFLOW_HOME}/run/mlflow.pid
GENERATED_DIR=${MLFLOW_HOME}/generated

MLFLOW_ALLOWED_HOSTS=mlflow.example.org,localhost,127.0.0.1
MLFLOW_CORS_ALLOWED_ORIGINS=https://mlflow.example.org,http://localhost

ENABLE_MLFLOW_AUTH=true
MLFLOW_FLASK_SERVER_SECRET_KEY=CHANGE_ME_WITH_LONG_RANDOM_SECRET
MLFLOW_AUTH_CONFIG_PATH=${MLFLOW_HOME}/config/basic_auth.ini
MLFLOW_AUTH_DB_URI=sqlite:///${MLFLOW_HOME}/data/basic_auth.db
MLFLOW_AUTH_DEFAULT_PERMISSION=NO_PERMISSIONS
MLFLOW_AUTH_ADMIN_USERNAME=admin
MLFLOW_AUTH_ADMIN_PASSWORD=CHANGE_ME_WITH_STRONG_PASSWORD
MLFLOW_AUTH_AUTHORIZATION_FUNCTION=mlflow.server.auth:authenticate_request_basic_auth

MLFLOW_BRIDGE_USER_HEADER=X-Email
MLFLOW_BRIDGE_AUTO_CREATE_USERS=true
MLFLOW_BRIDGE_ALLOW_BASIC_FALLBACK_LOCAL_ONLY=true
MLFLOW_BRIDGE_TRUSTED_LOCAL_ADDRS=127.0.0.1,::1,localhost
MLFLOW_BRIDGE_ADMIN_EMAILS=

ENABLE_GLOBUS_AUTH=false
PUBLIC_BASE_URL=https://mlflow.example.org
GLOBUS_OIDC_ISSUER_URL=https://auth.globus.org
GLOBUS_OAUTH_CLIENT_ID=REPLACE_WITH_GLOBUS_CLIENT_ID
GLOBUS_OAUTH_CLIENT_SECRET=REPLACE_WITH_GLOBUS_CLIENT_SECRET
OAUTH2_PROXY_COOKIE_SECRET=REPLACE_WITH_32BYTE_BASE64_SECRET
OAUTH2_PROXY_HTTP_ADDRESS=0.0.0.0:8081
OAUTH2_PROXY_EMAIL_DOMAINS=*
OAUTH2_PROXY_ALLOWED_EMAILS=

GENERATE_VM_NGINX_CONF=true
EXTERNAL_NGINX_USE_TLS=true
EXTERNAL_NGINX_AUTH_MODE=auth_request

MLFLOW_TRACKING_URI=https://mlflow.example.org
MLFLOW_USER_ADMIN_TRACKING_URI=http://127.0.0.1:8080
MLFLOW_SERVER_ENABLE_JOB_EXECUTION=false
